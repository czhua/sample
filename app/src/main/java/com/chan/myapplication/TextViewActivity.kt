package com.chan.myapplication

import android.os.Bundle
import android.widget.TextView
import androidx.appcompat.app.AppCompatActivity
import com.chan.myapplication.widget.TagTextView


const val TAG = "TextViewActivity"

class TextViewActivity : AppCompatActivity() {


    val title =
//        "WidelyconsidedredoneofthebestpracticalguidestoprogrammingSteve McConnells original "
//        "Widely con"
//    "Widely considedred one of the best practical guides to programming,               Steve McConnells original CODE COMPLETE has been"
//        "Widely considedred one of the best practical guides to programming,               Steve McConnells original CODE COMPLETE has been helping developers write better software for more than a decade. Now this classic book has been fully updated and revised with leading-edge practicesand hundreds of new code samplesillustrating the art and science of software construction. Capturing the"
//        "没有雪的冬季是不完整的，它能将你拉回到童年"
    "，顶得上整个万达。一出生就已是人生赢家，最后一位家庭背景吓人！还是有很多人不清楚。地球上最神秘的语言，跟世界其他语言毫无联系。夏季开车频繁使用空调会增大油耗，教你三招既能享受空调又省油！埋在金字塔下4500年，没用一颗钉子也能下水！这三大原因，看完你就会了解。只要能够背下这篇古文，就能够免费获得景区门票。两人在一起战斗一生，堪称黄金搭档，真相揭秘！《后会无期》曾在这个海岛拍摄，风景美还不用担心人多！看完不知道该羡慕还是心疼。伤胃更伤命！大多数人不在意。上面有8字预言，专家：2040年中国会发生此事。湖内装的不是湖水，竟然是“黑色黄金”！五个娶了“败家媳妇”的男星，不过都很幸福。2019年第7次目击事件，这次只出现1分钟！其结构极为紧密，到底是谁建造的？几千年过去了，至今都无人能解！专家打开墓穴，大吃一惊！除了隐身之外还有更大突破。外媒盘点世界上“最孤独的房子”，有些独自矗立在悬崖之上！河水清澈干净，究竟有何玄机？是不是太落后？答案其实很意外。导游：带与不带区别很大！乾隆曾献诗于它，最后却因一事留下遗憾！然而她却是一位伟大的女性。世界上最震撼的奇观，瀑布藏在海底，每秒倾泻50亿吨海水！仅有923名居民，每年却能吸引大量的游客！空气比日本还好，连一只蚊子都没有！孙中山的小妾比宋庆龄还厉害，连蒋介石也要巴结她。佟丽娅董璇都不算啥，他们才是高能。古城？莫高窟？鸣沙山?敦煌还有一处斥巨资的景点，很多人都去过。关晓彤排名第四，第一名竟然是她？只因照片里的一个秘密。千万要注意，别忽视！单身慎点！这四部国产剧甜到发腻，据说最后一部未播已火。意外造就了世界公路的奇迹！大部分人都搞错，连本国很多人也糊涂。精灵宝可梦吸金900亿美金，在这些ip面前漫威只能靠边站。他们不想家里人为了争财产而伤和气，早早便立下了遗嘱。这里是世界上唯一一个没有寡妇的民族，这儿的女性必须结三次婚。半夜醒来嘴里总是发干发苦，4种疾病你可曾考虑过？橘子好吃却不能乱吃，了解一下吧！与秋瑾齐名，样貌倾城，但却嫁不出去！这些未解之谜，在科学如此发达的今天依然找不到合理的解释。晚上运动后反而睡不着了？或许是因为没做这件事！村里近百分之十的人都是双胞胎。膝关节一动“咔咔响”，难道这是身体在报警？世界上最诡异的泉水，能将物体石化，被当地人认为具有魔法！古代的科举与如今的高考大对比，哪个更公平公正呢？大明本可不亡，可惜被崇祯忽略了。关之琳惊艳，李嘉欣漂亮，但都输给了她！上山要爬垂直楼梯，下山需要蹲着走！原来里面藏有玄机！科学家发现不让蚊子咬你的秘密！可惜刘备没有听取，导致关羽牺牲。太败家！却有很多人去求转运！真的有美国总统死于贫困吗？有，还是6个！闻名世界！你知道是哪吗？三步一貂蝉五步一西施，美女如云，大脑跟不上眼球。导游：接一次便懂为什么了。纳税也奇葩！日本长得帅要纳税，有个国家居然呼吸都要纳税。别不信，这四款衣服穿在你身上就是“灾难现场”，超级显老气。再馋也要戒了！下半年财运平稳上升，事业大有改善！教你几招安全喝牛奶！为什么健身房的教练都不建议跑步健身呢？3点告诉你真相！市面上的杨梅，都有“小白虫”？营养师说出3个真相！20多岁小伙被按成肩关节脱位，得不偿失！每天换着泡水喝，痛风也许会默默消失。为了身体着想，最好赶紧丢掉！最高的一张价值百万，堪称“币王”，你有吗？初夏餐桌必备，吃起来又脆又嫩，可惜很多人去把它扔了！香蕉这种水果不易保存且需要现代化设备运输，它竟还能保持低价！30年3000多高考状元，无一成为“行业领袖”。2019年考虑买房的人要注意了！三高的头号杀手，这四种吃法效果最好！这种食物是天生的解毒王，让你肝脏越来越健康。只需每天睡几个小时就可以，真的这么神奇吗？公安提醒：2019年酒桌上这四种情况要坐牢，可别不当回事！9月1日开始执行！早看早知道！消食止泻，开胃清热，甚至入药，简直浑身都是宝啊！他现场打架，最后一位吓坏宋茜！他们极可能是蚩尤的后代！被称为上天的恩赐，拿东西更加方便。甚至有时还会吃沙子、石头。这五只狗比哈士奇更狠，竟然拆家拆上了新闻，战斗力杠杠"


    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_text_view)
        val lineTv1 = findViewById<TextView>(R.id.line1_tv)
        val lineTv2 = findViewById<TextView>(R.id.line2_tv)
        val tagTv = findViewById<TextView>(R.id.tag_tv)
        var view = findViewById<TextView>(R.id.line3_tv)
        view.text = title
//        view.setTextColor(R.color.colorAccent)

        val tagTextView = findViewById<TagTextView>(R.id.tag_text_view)

        tagTextView.setText(title, "标题")
        LogUtil.d(TAG, "-----------------------------------a")
//        tagTextView.setTextColor(resources.getColor(R.color.colorAccent))
//        tagTextView.setTagBackgroundColor(resources.getColor(R.color.colorPrimary))
//        lineTv1.viewTreeObserver.addOnDrawListener {
        lineTv1.post {
            val measuredWidth1 = lineTv1.measuredWidth
            val measuredWidth2 = lineTv2.measuredWidth
            val tagWidth = tagTv.measuredWidth
//            val layoutParams = lineTv2.layoutParams as RelativeLayout.LayoutParams
//            layoutParams.setMargins(0, 0, tagWidth, 0)
//            lineTv2.layoutParams = layoutParams

            LogUtil.d(TAG, "measuredWidth1: $measuredWidth1, measuredWidth2:$measuredWidth2, tagWidth:$tagWidth")

            val split = title.split("""""")
            val sb = StringBuffer()
            LogUtil.d(TAG, "split:$split")
            run {
                split.forEach {
                    sb.append(it)
                    val measureText = lineTv1.paint.measureText(sb.toString())
                    LogUtil.d(TAG, "measureText: $measureText")
                    if (measureText >= measuredWidth1) {
                        LogUtil.d(
                            TAG,
                            "measureText >= measuredWidth1 measureText:$measureText, measuredWidth:$measuredWidth1, sb: $sb"
                        )
                        sb.deleteCharAt(sb.length - 1)
                        LogUtil.d(TAG, "sb: $sb")
                        val endSb = StringBuffer()
                        sb.forEachIndexed { index, c ->
                            val end = sb[sb.length - 1 - index]
                            if (Character.isLowerCase(end) || Character.isUpperCase(end)) {
                                LogUtil.d(TAG, "isLowerCase end: $end, index:$index")
                                endSb.append(end)
                            } else {
                                sb.delete(sb.length - endSb.length, sb.length)
                                return@run
                            }
                        }

                        return@run
                    }
                }
            }

            LogUtil.d(TAG, "ed sb: $sb")
            lineTv1.text = sb
            val substring = title.substring(sb.length)
            val measureText2 = lineTv2.paint.measureText(substring)
            val maxWidth = measuredWidth1 - tagWidth
            if (measureText2 > maxWidth) {
                lineTv2.width = maxWidth
            }
            lineTv2.text = substring.trim()
        }
    }
}
